#include "../include/utxo.h"\n#include <fstream>\n\nnamespace bnc {\n    \n    std::vector<uint8_t> UTXO::serialize() const {\n        std::vector<uint8_t> data;\n        // Implement serialization\n        return data;\n    }\n    \n    UTXO UTXO::deserialize(const std::vector<uint8_t>& data) {\n        UTXO utxo;\n        // Implement deserialization\n        return utxo;\n    }\n    \n    UTXOManager::UTXOManager() {}\n    \n    UTXOManager::~UTXOManager() {}\n    \n    void UTXOManager::add_utxo(const std::string& address, const UTXO& utxo) {\n        utxo_map[address].push_back(utxo);\n    }\n    \n    void UTXOManager::remove_utxo(const std::string& address, const std::string& txid, uint32_t index) {\n        auto it = utxo_map.find(address);\n        if (it != utxo_map.end()) {\n            auto& utxos = it->second;\n            utxos.erase(std::remove_if(utxos.begin(), utxos.end(),\n                [txid, index](const UTXO& u) { return u.txid == txid && u.index == index; }),\n                utxos.end());\n        }\n    }\n    \n    std::vector<UTXO> UTXOManager::get_utxos(const std::string& address) const {\n        auto it = utxo_map.find(address);\n        if (it != utxo_map.end()) {\n            return it->second;\n        }\n        return {};\n    }\n    \n    uint64_t UTXOManager::get_balance(const std::string& address) const {\n        auto utxos = get_utxos(address);\n        uint64_t balance = 0;\n        for (const auto& utxo : utxos) {\n            balance += utxo.amount;\n        }\n        return balance;\n    }\n    \n    bool UTXOManager::save_to_file(const std::string& filepath) {\n        std::ofstream file(filepath, std::ios::binary);\n        if (!file.is_open()) return false;\n        \n        uint32_t count = utxo_map.size();\n        file.write((char*)&count, sizeof(count));\n        \n        for (const auto& [address, utxos] : utxo_map) {\n            uint32_t addr_len = address.length();\n            file.write((char*)&addr_len, sizeof(addr_len));\n            file.write(address.c_str(), addr_len);\n            \n            uint32_t utxo_count = utxos.size();\n            file.write((char*)&utxo_count, sizeof(utxo_count));\n            \n            for (const auto& utxo : utxos) {\n                auto serialized = utxo.serialize();\n                uint32_t size = serialized.size();\n                file.write((char*)&size, sizeof(size));\n                file.write((char*)serialized.data(), size);\n            }\n        }\n        \n        file.close();\n        return true;\n    }\n    \n    bool UTXOManager::load_from_file(const std::string& filepath) {\n        std::ifstream file(filepath, std::ios::binary);\n        if (!file.is_open()) return false;\n        \n        uint32_t count;\n        file.read((char*)&count, sizeof(count));\n        \n        for (uint32_t i = 0; i < count; i++) {\n            uint32_t addr_len;\n            file.read((char*)&addr_len, sizeof(addr_len));\n            \n            std::string address(addr_len, '\0');\n            file.read(&address[0], addr_len);\n            \n            uint32_t utxo_count;\n            file.read((char*)&utxo_count, sizeof(utxo_count));\n            \n            for (uint32_t j = 0; j < utxo_count; j++) {\n                uint32_t size;\n                file.read((char*)&size, sizeof(size));\n                \n                std::vector<uint8_t> data(size);\n                file.read((char*)data.data(), size);\n                \n                UTXO utxo = UTXO::deserialize(data);\n                utxo_map[address].push_back(utxo);\n            }\n        }\n        \n        file.close();\n        return true;\n    }\n    \n    bool UTXOManager::is_utxo_available(const std::string& txid, uint32_t index) const {\n        for (const auto& [address, utxos] : utxo_map) {\n            for (const auto& utxo : utxos) {\n                if (utxo.txid == txid && utxo.index == index) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n}